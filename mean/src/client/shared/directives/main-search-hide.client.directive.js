(function() {
  'use strict';

  angular
    .module('shared')
    .directive('mainSearchHide', [
      '$rootScope',
      '$window',
      'variables',
      function($rootScope, $window, variables) {
        return {
          restrict: 'E',
          template: '<i class="md-icon header_main_search_close material-icons" ng-click="hideSearch()">&#xE5CD;</i>',
          replace: true,
          scope: true,
          link: function(scope, el, attr) {
            scope.hideSearch = function() {

              var $header_main = $('#header_main');

              $header_main
                .children('.header_main_search_form')
                .velocity('transition.slideUpBigOut', {
                  duration: 280,
                  easing: variables.easing_swiftOut,
                  begin: function() {
                    $header_main.velocity('reverse');
                    $rootScope.mainSearchActive = false;
                  },
                  complete: function() {
                    $header_main
                      .children('.header_main_content')
                      .velocity('transition.slideDownBigIn', {
                        duration: 280,
                        easing: variables.easing_swiftOut,
                        complete: function() {
                          $('.header_main_search_input').blur().val('');
                        }
                      });
                  }
                });

            };
          }
        };
      }
    ]);
}());
