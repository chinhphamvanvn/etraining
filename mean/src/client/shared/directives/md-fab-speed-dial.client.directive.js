(function() {
  'use strict';

  angular
    .module('shared')
    .directive('mdFabSpeedDial', [
      'variables',
      function(variables) {
        return {
          restrict: 'A',
          scope: true,
          link: function(scope, elem, attrs) {
            $(elem)
              .append('<i class="material-icons md-fab-action-close" style="display:none">&#xE5CD;</i>')
              .on('click', function(e) {
                e.preventDefault();

                var $this = $(this),
                  $this_wrapper = $this.closest('.md-fab-wrapper');

                if (!$this_wrapper.hasClass('md-fab-active')) {
                  $this_wrapper.addClass('md-fab-active');
                } else {
                  $this_wrapper.removeClass('md-fab-active');
                }

                $this.velocity({
                  scale: 0
                }, {
                  duration: 140,
                  easing: variables.easing_swiftOut,
                  complete: function() {
                    $this.children().toggle();
                    $this.velocity({
                      scale: 1
                    }, {
                      duration: 140,
                      easing: variables.easing_swiftOut
                    });
                  }
                });
              })
              .closest('.md-fab-wrapper').find('.md-fab-small')
              .on('click', function() {
                $(elem).trigger('click');
              });
          }
        };
      }
    ]);
}());
